<!DOCTYPE html>
<html lang="en-US" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  xmlns:th="http://www.thymeleaf.org"
	  layout:decorate="~{layout-admin/layout-admin}">
<body>
	<div layout:fragment="content">
		<script th:inline="javascript">
			$(document).ready(function() {
				var isCreation = [[${#request.getRequestURI().endsWith('create')? true : false}]];
				if (isCreation) {
					$("#selectRole").change(event => {
						if(event.target.value === 'doctor') {
							$('.specialization').each((key, value) => {
								value.removeAttribute('hidden');
							});
						}else{
							$('#specialization').val(null);
							$('.specialization').each((key, value) => {
								value.setAttribute('hidden', true);
							});
						}
					});	
				}
			});
			
			function checkImage(event){
				if(event.target.files.length){
					$('#uploadButton')[0].removeAttribute('hidden');
					$('#selectButton')[0].setAttribute('hidden', true);
				}
			}
		</script>
		
		<style>
	      label.label input[type="file"] {
	        position: absolute;
	        top: -1000px;
	      }
	      .label {
	        cursor: pointer;
	        border: 1px solid #cccccc;
	        border-radius: 5px;
	        padding: 5px 15px;
	        margin: 5px;
	        background: #dddddd;
	        display: inline-block;
	      }
	      .label:hover {
	        background: #5cbd95;
	      }
	      .label:active {
	        background: #9fa1a0;
	      }
	      .label:invalid + span {
	        color: #000000;
	      }
	      .label:valid + span {
	        color: #ffffff;
	      }
    	</style>
		
	    <div class="content-wrapper">
	        <div class="container-fluid overflow-hidden">
	            <div class="row margin-lr-10px">
	                <div class="margin-tb-45px full-width">
	                    <div class="padding-30px background-white border-radius-20 box-shadow">
	                    	<div class="row">
		                        <h1 class="col pl-4" th:text="#{${#request.getRequestURI().endsWith('update')? 'userForm.titleUpdate' : 'userForm.titleCreate'}}"><i class="far fa-user margin-right-10px text-main-color"></i> </h1>
	                    	</div>
	                        <hr>
	                        <div class="card card-info">
	                        	<div th:if="${#request.getRequestURI().endsWith('update')}" class="card-header">
	                        		<h3 class="card-title pt-2" th:text="#{${roleName == 'admin' ? 'role.admin' : (roleName == 'doctor' ? 'role.doctor' : 'role.patient')}}"></h3>
                        		</div>
	                        	
	                        	<div class="row">
	                        		<div th:if="${#request.getRequestURI().endsWith('update')}" class="col-sm-2" style="padding-right: 0">
	                        			<div class="card card-info" style="height: 100%; border: none;">
	                        				<div class="card-body">
	                        					<img th:if="${user.image != null}" th:src="@{${user.image.url.replaceAll('\\', '/')}}" class="img-thumbnail" width="304" height="236"/>
	                        					<img th:if="${user.image == null}" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" class="img-thumbnail" width="304" height="236"/>
	                        					
	                        					<form method="post" th:action="@{/admin/uploadImage}" enctype="multipart/form-data">
								                    <div class="form-group text-center mt-3">
								                        <label class="label" id="selectButton">
								                        <input type="hidden" name="userId" th:value="${user.id}"/>
														  <input type="file" name="file" class="form-control-file" id="image_uploads" accept=".jpg, .png" required onchange="checkImage(event)"/>
														  <span>[[#{image.select}]]</span>
														</label>
									                    <button id="uploadButton" type="submit" class="btn btn-primary" style="cursor: pointer;" hidden>[[#{image.upload}]]</button>
								                    </div>
								                </form>
	                        				</div>
	                        				<div class="card-footer pb-5">
	                        				</div>
	                        			</div>
	                        		</div>
	                        		<!--<div class="col-sm-10" style="padding-left: 0">-->
	                        		<div th:attr="class=${#request.getRequestURI().endsWith('update') ? 'col-sm-10' : 'col-sm-12'}, style=${#request.getRequestURI().endsWith('update') ? 'padding-left: 0' : ''}">
	                        			<form th:action="${#request.getRequestURI()}" th:object="${user}" class="form-horizontal" method="post">
										  <div class="card-body">
									  	  	<input th:if="${#request.getRequestURI().endsWith('update')}" type="hidden" th:field="*{id}"/>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">Username</label>
												<div class="col-sm-4">
													<span th:if="${#request.getRequestURI().endsWith('update')}" class="form-control" th:text="${user.username}" disabled></span>
													<input th:if="${#request.getRequestURI().endsWith('create')}" type="text" th:field="*{username}" class="form-control" required/>
													<!--<span th:if="${#fields.hasErrors('codice')}" th:each="err: ${#fields.errors('codice')}" th:utext="${err}"></span>-->
												</div>
												
												<label class="col-sm-2 col-form-label">Email</label>
												<div class="col-sm-4">
													<span th:if="${#request.getRequestURI().endsWith('update')}" class="form-control" th:text="${user.email}" disabled></span>
													<input th:if="${#request.getRequestURI().endsWith('create')}" type="text" th:field="*{email}" class="form-control" required/>
												</div>
												
											</div>
											<div th:if="${#request.getRequestURI().endsWith('create')}" class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">Password</label>
												<div class="col-sm-4">
													<input type="password" th:field="*{password}" class="form-control" required/>
												</div>
											</div>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">[[#{userForm.role}]]</label>
												<div class="col-sm-4">
													<select class="selectpicker form-control" name="roleName" id="selectRole">
														<option th:value="admin" th:attr="selected=${roleName == 'admin'}">[[#{role.admin}]]</option>
														<option th:value="doctor" th:attr="selected=${roleName == 'doctor'}">[[#{role.doctor}]]</option>
														<option th:if="${#request.getRequestURI().endsWith('update')}" th:value="patient" th:attr="selected=${roleName == 'patient'}">[[#{role.patient}]]</option>
													</select>
												</div>
												
												<label class="col-sm-2 col-form-label specialization" hidden="${roleName!='doctor'}">[[#{userForm.specialization}]]</label>
												<div class="col-sm-4 specialization" hidden="${roleName!='doctor'}">
													<input type="text" th:field="*{specialization}" class="form-control" id="specialization"/>
												</div>
											</div>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">[[#{userForm.name}]]</label>
												<div class="col-sm-4">
													<input type="text" th:field="*{name}" class="form-control"/>
												</div>
												
												<label class="col-sm-2 col-form-label">[[#{userForm.surname}]]</label>
												<div class="col-sm-4">
													<input type="text" th:field="*{surname}" class="form-control"/>
												</div>
											</div>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">[[#{userForm.dateOfBirth}]]</label>
												<div class="col-sm-4">
													<input type="date" th:field="*{dateOfBirth}" class="form-control"/>
												</div>
												
												<label class="col-sm-2 col-form-label">[[#{userForm.gender}]]</label>
												<div class="col-sm-4">
													<select class="selectpicker form-control" th:field="*{gender}">
														<option value="M">[[#{signUp.male}]]</option>
														<option value="F">[[#{signUp.female}]]</option>
													</select>
												</div>
											</div>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">[[#{userForm.fiscalCode}]]</label>
												<div class="col-sm-4">
													<input type="text" th:field="*{fiscalCode}" class="form-control"/>
												</div>
											</div>
											<div class="form-group row mb-3">
												<label class="col-sm-2 col-form-label">[[#{userForm.register}]]</label>
												<div class="col-sm-4">
													<input type="text" th:field="*{register}" class="form-control"/>
												</div>
												
												<label class="col-sm-2 col-form-label">[[#{userForm.skills}]]</label>
												<div class="col-sm-4">
													<textarea th:field="*{skills}" rows="" class="form-control"/>
												</div>
												
											</div>
											
										  </div>
										  <div class="card-footer pb-5">
											<button type="submit" class="btn btn-primary float-right" th:text="#{${#request.getRequestURI().endsWith('update')? 'userForm.update' : 'userForm.add'}}" style="cursor: pointer;"></button>
											<a href="#" th:href="@{/admin/users}" class="btn btn-default float-right pr-3" th:text="#{userForm.cancel}"></a>	
										  </div>
										</form>
	                        		</div>
	                        	</div>
							</div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
</body>
</html>